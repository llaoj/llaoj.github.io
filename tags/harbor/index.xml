<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Harbor on 老J的博客</title><link>https://blog.llaoj.cn/tags/harbor/</link><description>Recent content in Harbor on 老J的博客</description><generator>Hugo</generator><language>zh</language><lastBuildDate>Wed, 08 Jan 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.llaoj.cn/tags/harbor/index.xml" rel="self" type="application/rss+xml"/><item><title>解决Harbor漏洞扫描trivy失败</title><link>https://blog.llaoj.cn/posts/2025/fix-harbor-trivy-failure/</link><pubDate>Wed, 08 Jan 2025 00:00:00 +0000</pubDate><guid>https://blog.llaoj.cn/posts/2025/fix-harbor-trivy-failure/</guid><description>&lt;h2 id="问题描述">
 问题描述
 &lt;a class="anchor" href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0">#&lt;/a>
&lt;/h2>
&lt;p>
 &lt;img src="image.png" alt="alt text" />

 &lt;img src="image-1.png" alt="alt text" />&lt;/p>
&lt;p>点击查看日志, 错误日志如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>2025-01-08T01:53:23Z [INFO] [/pkg/scan/job.go:167]: Report mime types: [application/vnd.security.vulnerability.report; version=1.1]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2025-01-08T01:53:23Z [INFO] [/pkg/scan/job.go:224]: Get report for mime type: application/vnd.security.vulnerability.report; version=1.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2025-01-08T01:53:25Z [INFO] [/pkg/scan/job.go:245]: Report with mime type application/vnd.security.vulnerability.report; version=1.1 is not ready yet, retry after 5 seconds
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2025-01-08T01:53:30Z [ERROR] [/pkg/scan/job.go:294]: check scan report with mime type application/vnd.security.vulnerability.report; version=1.1: running trivy wrapper: running trivy: exit status 2: 2025-01-08T01:53:26.342Z	[INFO]	Vulnerability scanning is enabled
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>panic: invalid page type: 39: 10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>goroutine 1 [running]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*Cursor).search(0xc0059f8520, {0xc001ecfdb0, 0x47, 0x50}, 0x0?)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/cursor.go:250 +0x299
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*Cursor).searchPage(0xc0059f8520, {0xc001ecfdb0, 0x47, 0x50}, 0x6c3f5e0?)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/cursor.go:308 +0x166
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*Cursor).search(0xc0059f8520, {0xc001ecfdb0, 0x47, 0x50}, 0xc0059f84d8?)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/cursor.go:265 +0x1db
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*Cursor).seek(0xc0059f8520, {0xc001ecfdb0?, 0x50?, 0xc0059f8540?})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/cursor.go:159 +0x48
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*Bucket).Get(0xc0017caac0, {0xc001ecfdb0, 0x47, 0x50})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/bucket.go:262 +0x85
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/fanal/cache.FSCache.getBlob({_, {_, _}}, _, {_, _})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/fanal/cache/fs.go:70 +0x78
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/fanal/cache.FSCache.MissingBlobs.func1(0xc001ecee60?)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/fanal/cache/fs.go:164 +0x153
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go.etcd.io/bbolt.(*DB).View(0x41429f?, 0xc0059f8ae8)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/go.etcd.io/bbolt@v1.3.6/db.go:772 +0x82
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/fanal/cache.FSCache.MissingBlobs({0xc005b978c0?, {0xc005874320?, 0xc001bea7a0?}}, {0xc001ecf5e0, 0x47}, {0xc0026df700?, 0x0?, 0x0?})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/fanal/cache/fs.go:161 +0xfe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/fanal/artifact/image.Artifact.Inspect({{0x82dd970, 0xc001747880}, {0x7fb90c068258, 0xc001a23be0}, {{{0x0, 0x0, 0x0}, {0xc001747dc0, 0x3, 0x4}}}, ...}, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/fanal/artifact/image/image.go:116 +0x6b1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/scanner.Scanner.ScanArtifact({{_, _}, {_, _}}, {_, _}, {{0xc00164eca0, 0x2, 0x2}, {0xc0019e7d50, ...}, ...})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/scanner/scan.go:125 +0x103
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/commands/artifact.scan({_, _}, {{{0x71a5e83, 0xa}, 0x0, 0x0, 0x0, 0x0, 0x45d964b800, {0x7ffcbf77b887, ...}, ...}, ...}, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/commands/artifact/run.go:542 +0x36b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/commands/artifact.(*runner).scanArtifact(_, {_, _}, {{{0x71a5e83, 0xa}, 0x0, 0x0, 0x0, 0x0, 0x45d964b800, ...}, ...}, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/commands/artifact/run.go:228 +0xdd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/commands/artifact.(*runner).ScanImage(_, {_, _}, {{{0x71a5e83, 0xa}, 0x0, 0x0, 0x0, 0x0, 0x45d964b800, ...}, ...})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/commands/artifact/run.go:174 +0x165
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/commands/artifact.Run({_, _}, {{{0x71a5e83, 0xa}, 0x0, 0x0, 0x0, 0x0, 0x45d964b800, {0x7ffcbf77b887, ...}, ...}, ...}, ...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/commands/artifact/run.go:369 +0xaa4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/aquasecurity/trivy/pkg/commands.NewImageCommand.func2(0xc003f2ca00, {0xc0026de600?, 0x1?, 0x10?})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/pkg/commands/app.go:269 +0x185
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/spf13/cobra.(*Command).execute(0xc003f2ca00, {0xc0026de400, 0x10, 0x10})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:872 +0x694
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/spf13/cobra.(*Command).ExecuteC(0xc003f2c780)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:990 +0x3bd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>github.com/spf13/cobra.(*Command).Execute(...)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/go/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:918
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>main.run()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/cmd/trivy/main.go:37 +0x177
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>main.main()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	/home/runner/work/trivy/trivy/cmd/trivy/main.go:19 +0x19
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>: general response handler: unexpected status code: 500, expected: 200
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>看日志中的错误堆栈, 我发现在读取trivy数据库文件的时候报错了, 所以我的解决办法是, 删掉原来的数据库文件, 让trivy重建一个.&lt;/p></description></item><item><title>Harbor 双主复制解决方案实践</title><link>https://blog.llaoj.cn/posts/2203/harbor-dual-master-replication-ha/</link><pubDate>Tue, 29 Mar 2022 00:00:00 +0000</pubDate><guid>https://blog.llaoj.cn/posts/2203/harbor-dual-master-replication-ha/</guid><description>既然使用了外部的服务, 那么高可用的压力自然而然的转移到了外部服务上. 我们一开始采用的外部的 NFS 共享存储服务, 由于我们团队实际情况, 我们暂时还不能保证外部存储的高可用. 同时, 鉴于我们对镜像服务高可用的迫切需求, 决定调研新的 Harbor 的高可用方案.</description></item></channel></rss>