<!doctype html><html lang=zh dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="kubernetes">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.llaoj.cn/tags/kubernetes/">
<title>kubernetes | 老J的博客</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.18b5d651e266e5e9cfc7455e2e50eb1b74a62aee16cf204b69de1d9e695276f7.css integrity="sha256-GLXWUeJm5enPx0VeLlDrG3SmKu4WzyBLad4dnmlSdvc=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/zh.search.min.8de9e877034c987c1e2266583968bb83081bf04ddfc8397228483e0deebeed28.js integrity="sha256-jenodwNMmHweImZYOWi7gwgb8E3fyDlyKEg+De6+7Sg=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://blog.llaoj.cn/tags/kubernetes/index.xml title=老J的博客>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><img src=/j.png alt=Logo><span>老J的博客</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<img src=/images/avatar.jpg width=150 style=border-radius:8px>
<p style=display:flex;align-items:center><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 30 30"><path d="M15 3C8.373 3 3 8.373 3 15c0 5.623 3.872 10.328 9.092 11.63C12.036 26.468 12 26.28 12 26.047v-2.051c-.487.0-1.303.0-1.508.0-.821.0-1.551-.353-1.905-1.009-.393-.729-.461-1.844-1.435-2.526-.289-.227-.069-.486.264-.451.615.174 1.125.596 1.605 1.222.478.627.703.769 1.596.769.433.0 1.081-.025 1.691-.121.328-.833.895-1.6 1.588-1.962-3.996-.411-5.903-2.399-5.903-5.098.0-1.162.495-2.286 1.336-3.233C9.053 10.647 8.706 8.73 9.435 8c1.798.0 2.885 1.166 3.146 1.481C13.477 9.174 14.461 9 15.495 9c1.036.0 2.024.174 2.922.483C18.675 9.17 19.763 8 21.565 8c.732.731.381 2.656.102 3.594.836.945 1.328 2.066 1.328 3.226.0 2.697-1.904 4.684-5.894 5.097C18.199 20.49 19 22.1 19 23.313v2.734c0 .104-.023.179-.035.268C23.641 24.676 27 20.236 27 15 27 8.373 21.627 3 15 3z"/></svg>
<a href=https://github.com/llaoj target=_blank style=padding-top:5px>@llaoj</a>
</p>
<ul>
<li>
<a href=/posts/>
文章
</a>
</li>
</ul>
<ul>
<li>
<span>我的项目</span>
<ul>
<li>
<a href=/docs/mywork/gcopy/>GCopy</a>
</li>
<li>
<a href=/docs/mywork/oauth2nsso/>OAuth2&SSO</a>
</li>
<li>
<a href=/docs/mywork/kubefinder/>KubeFinder</a>
</li>
</ul>
</li>
<li>
<a href=/docs/about/>关于</a>
<ul>
</ul>
</li>
</ul>
<ul>
<li>
<a href=https://www.cncf.io/ target=_blank rel=noopener>
CNCF
</a>
</li>
<li>
<a href=https://ebpf.io/ target=_blank rel=noopener>
eBPF
</a>
</li>
</ul>
<div class=book-menu-after>
<a href=https://www.rutron.net/ target=_blank>@如创科技</a><br>提供云计算支持</p>
</div>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>kubernetes</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav>
<ul>
<li class=book-section-flat>
<strong>Categories</strong>
<ul>
<li class="flex justify-between">
<a href=/categories/technology/>technology</a>
<span>37</span>
</li>
</ul>
</li>
<li class=book-section-flat>
<strong>Tags</strong>
<ul>
<li class="flex justify-between">
<a href=/tags/harbor/>harbor</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubernetes/>kubernetes</a>
<span>20</span>
</li>
<li class="flex justify-between">
<a href=/tags/velero/>velero</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/docker/>docker</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/oracle/>oracle</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/fluentd/>fluentd</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/envoy/>envoy</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/rsync/>rsync</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/etcd/>etcd</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/istio/>istio</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/metallb/>metallb</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/cgroups/>cgroups</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/apisix/>apisix</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/grafana-mimir/>grafana mimir</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/prometheus/>prometheus</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/golang/>golang</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/bcc/>bcc</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/ebpf/>ebpf</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubectl/>kubectl</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubelet/>kubelet</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/linux/>linux</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/nfs/>nfs</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/ldap/>ldap</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubespray/>kubespray</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/pod/>pod</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/backup/>backup</a>
<span>1</span>
</li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class="markdown book-post">
<h2>
<a href=/posts/2025/fix-kubectl-no-authorization/>解决执行kubectl命令没有权限</a>
</h2>
<h5>2025-1-8</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>问题描述 # 反应执行kubectl命令没有权限:
$ kubectl get pod -A Error from server (Forbidden): pods is forbidden: User "kubernetes-admin" cannot list resource "pods" in API group "" at the cluster scope 解决思路 # 首先要了解几个文件夹的作用:
<a href=/posts/2025/fix-kubectl-no-authorization/>...</a>
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2309/velero-failed-to-list-daemonset-pods/>解决Velero报错: failed to list daemonset pods: client rate limiter Wait returned an error: context deadline exceeded</a>
</h2>
<h5>2023-9-4</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>,
<a href=/tags/velero/>velero</a>
</div>
<p>使用VeleroFSB备份集群的时候, 遇到了一些错误, 导致整个备份任务没有成功, 状态: <code>PartiallyFailed</code>: failed to list daemonset pods: client rate limiter Wait returned an error: context deadline exceeded
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2304/container-tcp-conn/>通过shell脚本扫描从Kubernetes节点往外的tcp请求</a>
</h2>
<h5>2023-4-4</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>由于Kubernetes中部署的服务队外发起的tcp请求很难监控, 最近数据库运维在排查来自集群的大量数据库请求, 网络层只能看到来自哪个Kubernetes节点主机. 所以写了下面这个脚本来定时扫描.
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2207/fluentd-es-config/>Fluentd配置文件最佳实践</a>
</h2>
<h5>2022-7-31</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>,
<a href=/tags/fluentd/>fluentd</a>
</div>
<p>Fluentd负责Kubernetes中容器日志的收集工作, 以Daemonset形式运行在每一个节点上. 下面这个配置是在多个生产集群使用的配置, 经过多次调优的. 有一些关键的配置增加了配置解释说明. 目前使用问题不大. 持续更新配置中&mldr;
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2207/kubernetes-requirement/>Kubernetes 服务器配置和规划建设要求</a>
</h2>
<h5>2022-7-16</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>新建集群的第一步就是要规划服务器、网络、操作系统等等, 下面就结合我平时的工作经验总结下相关的要求, 内容根据日常工作持续补充完善:
服务器配置 # kubernetes 集群分为控制节点和数据节点, 它们对于配置的要求有所不同:
控制面 # 节点规模 Master规格 1~5个节点 4核 8Gi（不建议2核 4Gi） 6~20个节点 4核 16Gi 21~100个节点 8核 32Gi 100~200个节点 16核 64Gi 系统盘40+Gi，用于储存 etcd 信息及相关配置文件等
<a href=/posts/2207/kubernetes-requirement/>...</a>
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2205/cgroups-process-isolation/>Linux 控制组(cgroups)和进程隔离</a>
</h2>
<h5>2022-5-15</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/cgroups/>cgroups</a>,
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>控制组(cgroups)是内核的一个特性，它能限制/统计/隔离一个或者多个进程使用CPU、内存、磁盘I/O和网络。cgroups技术最开始是Google开发，最终在2.6.24版本的内核中出现。3.15和3.16版本内核将合并进重新设计的cgroups，它添加来kernfs(拆分一些sysfs逻辑)。cgroups的主要设计目标是提供一个统一的接口，它可以管理进程或者整个操作系统级别的虚拟化，包含Linux容器，或者LXC。
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2204/kubernetes-node-load/>分析告警 kubernetes 节点 load 过高问题</a>
</h2>
<h5>2022-4-27</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>负载过高分析 # 通过 linux 提供的几个命令可以从不同的纬度分析系统负载。
vmstat # 这命令能从一个系统的角度反应出服务器情况，报告虚拟内存统计信息，报告有关进程、内存、分页、块的信息 IO、陷阱、磁盘和 CPU 活动。看个例子：
$ vmstat --wide --unit M 5 procs ----------------memory---------------- ---swap--- -----io---- ---system--- ---------cpu-------- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 1 0 127691 1535 73572 0 0 0 3 0 0 2 1 97 0 0 93 0 0 127674 1535 73573 0 0 0 80 49267 67634 5 1 94 1 0 0 2 0 127679 1535 73573 0 0 0 66 38537 56283 3 1 95 1 0 2 2 0 127738 1535 73574 0 0 6 86 41769 61823 5 1 93 2 0 2 0 0 127729 1535 73574 0 0 18 18 41002 59214 4 1 95 0 0 命令以及输出解释：
<a href=/posts/2204/kubernetes-node-load/>...</a>
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2204/apisix-ingress-controller-design/>Apisxi Ingress Controller 设计说明</a>
</h2>
<h5>2022-4-14</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/apisix/>apisix</a>,
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>apisix-ingress-controller 要求 kubernetes 版本 1.16+. 因为使用了 CustomResourceDefinition v1 stable 版本的 API. 从 1.0.0 版本开始，APISIX-ingress-controller 要求 Apache APISIX 版本 2.7+.
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2203/execjava-versioninpod/>在 kubernetes 中找出使用 jdk9 及以上版本的应用</a>
</h2>
<h5>2022-3-30</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/golang/>golang</a>,
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>近日, Spring Cloud (SPEL) 中发现 RCE 0-day 漏洞, 为了排查 kubernetes 中所有存在安全威胁的应用. 特地开发了一个小工具来寻找。该工具基于 golang&client-go 开发, 程序会找出当前集群中所有 Running 的 pods, 然后逐个进入容器，执行 <code>java -version</code> 命令，将命令输出打印到文件中，使用编辑器进行查找检索即可。
</p>
</article>
<article class="markdown book-post">
<h2>
<a href=/posts/2203/find-ns-that-exceed-resource-limits/>在 kubernetes 中找出过度使用资源的 namespaces</a>
</h2>
<h5>2022-3-28</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/golang/>golang</a>,
<a href=/tags/kubernetes/>kubernetes</a>
</div>
<p>我们知道, 在 kubernetes 中, namespace 的资源限制在 ResourceQuota 中定义, 比如我们控制 default 名称空间使用 1核1G 的资源. 通常来讲, 由于 kubernetes 的资源控制机制, <code>.status.used</code> 中资源的值会小于 <code>.status.hard</code> 中相应资源的值. 但是也有特例. 当我们开始定义了一个较大的资源限制, 待应用部署完毕, 资源占用了很多之后, 这时调低资源限制. 此时就会出现 <code>.status.used</code> 中的值超过 <code>.status.hard</code> 中相应值的情况, 尤其是内存的限制.
</p>
</article>
<ul class="pagination pagination-default">
<li class="page-item disabled">
<a aria-disabled=true aria-label=First class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;&#171;</span></a>
</li>
<li class="page-item disabled">
<a aria-disabled=true aria-label=Previous class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;</span></a>
</li>
<li class="page-item active">
<a aria-current=page aria-label="Page 1" class=page-link role=button>1</a>
</li>
<li class=page-item>
<a href=/tags/kubernetes/page/2/ aria-label="Page 2" class=page-link role=button>2</a>
</li>
<li class=page-item>
<a href=/tags/kubernetes/page/2/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a>
</li>
<li class=page-item>
<a href=/tags/kubernetes/page/2/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a>
</li>
</ul>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav>
<ul>
<li class=book-section-flat>
<strong>Categories</strong>
<ul>
<li class="flex justify-between">
<a href=/categories/technology/>technology</a>
<span>37</span>
</li>
</ul>
</li>
<li class=book-section-flat>
<strong>Tags</strong>
<ul>
<li class="flex justify-between">
<a href=/tags/harbor/>harbor</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubernetes/>kubernetes</a>
<span>20</span>
</li>
<li class="flex justify-between">
<a href=/tags/velero/>velero</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/docker/>docker</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/oracle/>oracle</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/fluentd/>fluentd</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/envoy/>envoy</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/rsync/>rsync</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/etcd/>etcd</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/istio/>istio</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/metallb/>metallb</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/cgroups/>cgroups</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/apisix/>apisix</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/grafana-mimir/>grafana mimir</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/prometheus/>prometheus</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/golang/>golang</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/bcc/>bcc</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/ebpf/>ebpf</a>
<span>3</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubectl/>kubectl</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubelet/>kubelet</a>
<span>2</span>
</li>
<li class="flex justify-between">
<a href=/tags/linux/>linux</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/nfs/>nfs</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/ldap/>ldap</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/kubespray/>kubespray</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/pod/>pod</a>
<span>1</span>
</li>
<li class="flex justify-between">
<a href=/tags/backup/>backup</a>
<span>1</span>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>