- [分布式锁](#分布式锁)
- [redis实现分布式锁](#redis实现分布式锁)
  - [redis实现redlock](#redis实现redlock)
  - [数据分片](#数据分片)
  - [redis集群](#redis集群)
    - [一致性哈希算法](#一致性哈希算法)
- [zookeeper 实现分布式锁](#zookeeper-实现分布式锁)
  - [zookeeper的几种节点类型](#zookeeper的几种节点类型)
  - [zookeeper的session机制](#zookeeper的session机制)

## 分布式锁

**应用场景**

- 秒杀
- 接口幂等性校验

![redis](pic/mysql/binary-tree.png)

接口幂等性就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的, 比如用户购买商品后支付，支付扣款成功，但是返回结果的时候网络异常，此时钱已经扣了，用户再次点击按钮，此时会进行第二次扣款，返回结果成功，用户查询余额返发现多扣钱了，流水记录也变成了两条．．．,这就没有保证接口的幂等性

具体到数据库上, 比如数据的增量修改必须要保证幂等性, 还有增加也要保证.

- [x] 抢购
- [x] 抢购
- [ ] 抢购

## redis实现分布式锁

### redis实现redlock

### 数据分片

### redis集群

#### 一致性哈希算法

## zookeeper 实现分布式锁

### zookeeper的几种节点类型

| 类型       | 说明  |      |
| :--------- | :---: | :--- |
| 持久化节点 |       |
| 临时节点   |       |

### zookeeper的session机制