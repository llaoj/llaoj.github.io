<!doctype html><html lang=zh dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Envoy静态配置 #  L4转发 #  下面的例子是配置4层转发, 将443端口的流量都代理到www.example.com对应的后端的443端口上, 如下:
static_resources:listeners:- name:listener_0address:socket_address:protocol:TCPaddress:0.0.0.0port_value:443filter_chains:- filters:- name:envoy.filters.network.tcp_proxytyped_config:&#34;@type&#34;: type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxystat_prefix:tcp_443cluster:cluster_0clusters:- name:cluster_0type:LOGICAL_DNSdns_lookup_family:V4_ONLYload_assignment:cluster_name:cluster_0endpoints:- lb_endpoints:- endpoint:address:socket_address:address:www.example.comport_value:443启动Envoy #  将创建的静态配置文件envoy-custom.yaml映射到容器内部, 启动:
docker run -d --name=envoy --restart=always \  -p 443:443 -v /root/envoy-custom.yaml:/etc/envoy/envoy.yaml \  envoyproxy/envoy:v1.22.2 ">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Envoy的静态配置使用方法">
<meta property="og:description" content="Envoy静态配置 #  L4转发 #  下面的例子是配置4层转发, 将443端口的流量都代理到www.example.com对应的后端的443端口上, 如下:
static_resources:listeners:- name:listener_0address:socket_address:protocol:TCPaddress:0.0.0.0port_value:443filter_chains:- filters:- name:envoy.filters.network.tcp_proxytyped_config:&#34;@type&#34;: type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxystat_prefix:tcp_443cluster:cluster_0clusters:- name:cluster_0type:LOGICAL_DNSdns_lookup_family:V4_ONLYload_assignment:cluster_name:cluster_0endpoints:- lb_endpoints:- endpoint:address:socket_address:address:www.example.comport_value:443启动Envoy #  将创建的静态配置文件envoy-custom.yaml映射到容器内部, 启动:
docker run -d --name=envoy --restart=always \  -p 443:443 -v /root/envoy-custom.yaml:/etc/envoy/envoy.yaml \  envoyproxy/envoy:v1.22.2 ">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.llaoj.cn/posts/2209/envoy-usage/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-09-15T00:00:00+00:00">
<meta property="article:modified_time" content="2022-09-15T00:00:00+00:00">
<title>Envoy的静态配置使用方法 | 老J的博客</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.18b5d651e266e5e9cfc7455e2e50eb1b74a62aee16cf204b69de1d9e695276f7.css integrity="sha256-GLXWUeJm5enPx0VeLlDrG3SmKu4WzyBLad4dnmlSdvc=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/zh.search.min.c8a06b82bf5c0d984afb4fb411043d953957bacaa54eef9e125fa71d2addd721.js integrity="sha256-yKBrgr9cDZhK+0+0EQQ9lTlXusqlTu+eEl+nHSrd1yE=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><img src=/j.png alt=Logo><span>老J的博客</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=/posts/>
文章
</a>
</li>
</ul>
<ul>
<li>
<span>我的项目</span>
<ul>
<li>
<a href=/docs/mywork/gcopy/>GCopy</a>
</li>
<li>
<a href=/docs/mywork/oauth2nsso/>OAuth2&SSO</a>
</li>
<li>
<a href=/docs/mywork/kubefinder/>KubeFinder</a>
</li>
</ul>
</li>
<li>
<a href=/docs/about/>关于</a>
<ul>
</ul>
</li>
</ul>
<ul>
<li>
<a href=https://www.cncf.io/ target=_blank rel=noopener>
CNCF
</a>
</li>
<li>
<a href=https://ebpf.io/ target=_blank rel=noopener>
eBPF
</a>
</li>
</ul>
<div class=book-menu-after>
<a href=https://www.rutron.net/ target=_blank>@如创科技</a><br>提供云计算支持
</div>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Envoy的静态配置使用方法</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#envoy静态配置>Envoy静态配置</a>
<ul>
<li><a href=#l4转发>L4转发</a></li>
</ul>
</li>
<li><a href=#启动envoy>启动Envoy</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1>
<a href=/posts/2209/envoy-usage/>Envoy的静态配置使用方法</a>
</h1>
<h5>2022-9-15</h5>
<div>
<a href=/categories/technology/>technology</a>
</div>
<div>
<a href=/tags/envoy/>envoy</a>
</div>
<h2 id=envoy静态配置>
Envoy静态配置
<a class=anchor href=#envoy%e9%9d%99%e6%80%81%e9%85%8d%e7%bd%ae>#</a>
</h2>
<h3 id=l4转发>
L4转发
<a class=anchor href=#l4%e8%bd%ac%e5%8f%91>#</a>
</h3>
<p>下面的例子是配置4层转发, 将443端口的流量都代理到<code>www.example.com</code>对应的后端的443端口上, 如下:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:navy>static_resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>listeners</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>listener_0<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>address</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>socket_address</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>address</span>:<span style=color:#bbb> </span><span style=color:#099>0.0.0.0</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>port_value</span>:<span style=color:#bbb> </span><span style=color:#099>443</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>filter_chains</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:navy>filters</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>envoy.filters.network.tcp_proxy<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>typed_config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>&#34;@type&#34;: </span>type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>stat_prefix</span>:<span style=color:#bbb> </span>tcp_443<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>cluster</span>:<span style=color:#bbb> </span>cluster_0<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>clusters</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>cluster_0<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>type</span>:<span style=color:#bbb> </span>LOGICAL_DNS<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>dns_lookup_family</span>:<span style=color:#bbb> </span>V4_ONLY<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>load_assignment</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>cluster_name</span>:<span style=color:#bbb> </span>cluster_0<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>endpoints</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>lb_endpoints</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:navy>endpoint</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>address</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:navy>socket_address</span>:<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:navy>address</span>:<span style=color:#bbb> </span>www.example.com<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:navy>port_value</span>:<span style=color:#bbb> </span><span style=color:#099>443</span><span style=color:#bbb>
</span></code></pre></div><h2 id=启动envoy>
启动Envoy
<a class=anchor href=#%e5%90%af%e5%8a%a8envoy>#</a>
</h2>
<p>将创建的静态配置文件<code>envoy-custom.yaml</code>映射到容器内部, 启动:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker run -d --name<span style=color:#000;font-weight:700>=</span>envoy --restart<span style=color:#000;font-weight:700>=</span>always <span style=color:#d14>\
</span><span style=color:#d14></span>    -p 443:443
    -v /root/envoy-custom.yaml:/etc/envoy/envoy.yaml <span style=color:#d14>\
</span><span style=color:#d14></span>    envoyproxy/envoy:v1.22.2
</code></pre></div></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css>
<script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script>
<div id=gitalk-container></div>
<script type=text/javascript>const gitalk=new Gitalk({clientID:'53c7373e7b1554a4abc3',clientSecret:'7c9dcef80ea6bde5d8695d1ab94bcef87063fb3b',repo:'llaoj.github.io',owner:'llaoj',admin:['llaoj'],id:location.pathname,distractionFreeMode:!1});gitalk.render('gitalk-container')</script></div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#envoy静态配置>Envoy静态配置</a>
<ul>
<li><a href=#l4转发>L4转发</a></li>
</ul>
</li>
<li><a href=#启动envoy>启动Envoy</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>